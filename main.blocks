<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="}WpVq$`:(BfzInb:PcSX">oneminuteinmilliseconds</variable><variable id="x5qV7:/x5,w793W1=#iZ">minlightvalue</variable><variable id="8(qu^%~:1:@]I$Rk]:U!">maxlightvalue</variable><variable id=".%2TB{#Q!ydFfo;DabN)">currentlightreading</variable><variable id="EC*d+^c;[2hCdigiOQcs">hashitminlightlevel</variable><variable id="Vwy?JJB6[VGaGUwe1|d?">currenttime</variable><variable id="=MF_`:xek;eFlF_YHAOQ">lastreportime</variable><variable id="^lO;,F.4EDoh#[L$o6}d">lasttriggertime</variable></variables><block type="pxt-on-start" id="BhmNSx4O8tb~4KS~~E97" x="0" y="0"><statement name="HANDLER"><block type="variables_set" id="*e#D=.s5$:Nt@mp%q{iG"><field name="VAR" id="}WpVq$`:(BfzInb:PcSX">oneminuteinmilliseconds</field><value name="VALUE"><shadow type="math_number" id="cgI{}/j2i0%ADeEBm4O2"><field name="NUM">60000</field></shadow></value><next><block type="variables_set" id="P+$MfKL+])38j=zV6lNG"><field name="VAR" id="x5qV7:/x5,w793W1=#iZ">minlightvalue</field><value name="VALUE"><shadow type="math_number" id="yM}[e$=30@gZi$)~,k/M"><field name="NUM">5</field></shadow></value><next><block type="variables_set" id="MlD+,DHN`%#-[,?Xp={:"><field name="VAR" id="8(qu^%~:1:@]I$Rk]:U!">maxlightvalue</field><value name="VALUE"><shadow type="math_number" id="S:OMQ][Q4l^*]hJD8o%n"><field name="NUM">7</field></shadow></value><next><block type="serial_writeline" id="7qOP]n6-P(:m8ji__DWl"><value name="text"><shadow type="text" id="KR;#|FprFhy7,X_CB|w6"><field name="TEXT">ready to start</field></shadow></value><next><block type="device_while" id="mS=:G+Y4L{{S}W{1VQ)Z"><value name="COND"><shadow type="logic_boolean" id="xeh?}RRjiI0nw*VOkNTb"><field name="BOOL">TRUE</field></shadow></value><statement name="DO"><block type="variables_set" id="xckjk#J#A9z-IAet/*Lk"><field name="VAR" id=".%2TB{#Q!ydFfo;DabN)">currentlightreading</field><comment>get current reading then devide value by a number that brings it into single digits, in our case % 100 this makes it easier to detect high and low light values as there are fewer steps in light level available</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_js_op" id="u$dG,_=24@=qE8is7!nb"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_get_analog_pin" id="YX=Yj53?$orbu8zH~iTF"><field name="name">AnalogPin.P0</field></block></value><value name="ARG1"><shadow type="math_number" id="rP#8;Iqen3iNz}+@8|Av"><field name="NUM">100</field></shadow></value></block></value><next><block type="controls_if" id="$_,~_zd1EXG;jwVaBcC5"><comment>uncomment line below to calibrate min and max light values but be sure to comment out again before trying to calculate RPM serial.writeValue("light reading", currentlightreading) check if light has dimmed to lowest value BUT has been to the highest value first this reduces / elimenates false positive readings</comment><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_operation" id="AbRWIc)nmO4Q(PU-GN^E"><field name="OP">AND</field><value name="A"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="h;M2OKDkRI4@G%)2(xuN"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="E1~I,RLj6!VF#^,C1h50"><field name="VAR" id=".%2TB{#Q!ydFfo;DabN)">currentlightreading</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="QE4:y^TLc)xm*^4OSCNo"><field name="VAR" id="x5qV7:/x5,w793W1=#iZ">minlightvalue</field></block></value></block></value><value name="B"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="fK^E/)gDG|(fB@YDgb=("><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="!G|}(LY7~Eid*m!=8s5T"><field name="VAR" id="EC*d+^c;[2hCdigiOQcs">hashitminlightlevel</field></block></value><value name="B"><shadow type="logic_boolean" id="Z|?cgsEX1(mTD#2Uq..*"><field name="BOOL">FALSE</field></shadow></value></block></value></block></value><statement name="DO0"><block type="variables_set" id="#tD`C-$`]k1.~RYOAxWy"><field name="VAR" id="EC*d+^c;[2hCdigiOQcs">hashitminlightlevel</field><value name="VALUE"><shadow type="logic_boolean" id="c!w3my`vG4~aPr4DI79/"><field name="BOOL">TRUE</field></shadow></value><next><block type="variables_set" id="uVO|+cV-X6hbV9bh#0)?"><field name="VAR" id="Vwy?JJB6[VGaGUwe1|d?">currenttime</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_get_running_time" id="|{2S8hF4j-ep]0){.rvp"/></value><next><block type="controls_if" id="1AV7!1|m2X740`-6IK.f"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="2^p;Ax#?HhBCzH){6im}"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id=")%:$aDmAA=V{C!uF1S}="><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="}qKP$B|.Jj4eu/#8kR)L"><field name="VAR" id="Vwy?JJB6[VGaGUwe1|d?">currenttime</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="/d0%(8$uZh:0B%sFqW`h"><field name="VAR" id="=MF_`:xek;eFlF_YHAOQ">lastreportime</field></block></value></block></value><value name="B"><shadow type="math_number" id="4crQ4I[;TEqKL/AqAmj]"><field name="NUM">1000</field></shadow></value></block></value><statement name="DO0"><block type="variables_set" id="|6_Ey`jEHX=;;IDZ+i,B"><field name="VAR" id="=MF_`:xek;eFlF_YHAOQ">lastreportime</field><comment>write our result at most once per second otherwise serial.write slows down the reading of the light sensor too much</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="Ib:{k8IEAS:lD@ZjhUPp"><field name="VAR" id="Vwy?JJB6[VGaGUwe1|d?">currenttime</field></block></value><next><block type="serial_writevalue" id="0@VbAsZ2kbPm4M?1UBTG"><value name="name"><shadow type="text" id="13i6[Uk(+Vm2oi3HI8sb"><field name="TEXT">RPM</field></shadow></value><value name="value"><block type="typescript_expression" id="IG,WQH}^LTjE}8j`-Pf0" editable="false"><field name="EXPRESSION"> calculateCurrentRPM(lasttriggertime, currenttime)</field></block></value></block></next></block></statement><next><block type="variables_set" id="],y~;9$1!b%?ifLGM_Q["><field name="VAR" id="^lO;,F.4EDoh#[L$o6}d">lasttriggertime</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="b4n2K]K1FfB=S)4mKQQH"><field name="VAR" id="Vwy?JJB6[VGaGUwe1|d?">currenttime</field></block></value></block></next></block></next></block></next></block></statement><next><block type="controls_if" id="BIHCrO,^UcB*^RbAT%D*"><comment>check if light has reached highest value and if so reset hashitminlightlevel ready for  detection of next lowest light value</comment><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="L=+!t4}yexzHHToWks:e"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="IHA?W,+eeeYPVygWC[sP"><field name="VAR" id=".%2TB{#Q!ydFfo;DabN)">currentlightreading</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="Myfe!GHv%SDquqdf8k5n"><field name="VAR" id="8(qu^%~:1:@]I$Rk]:U!">maxlightvalue</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="{J;lG`uX3~)qw?$V,.!2"><field name="VAR" id="EC*d+^c;[2hCdigiOQcs">hashitminlightlevel</field><value name="VALUE"><shadow type="logic_boolean" id="^pIF8^?t^vy#~01a=`(."><field name="BOOL">FALSE</field></shadow></value></block></statement></block></next></block></next></block></statement><next><block type="typescript_statement" id="+zIs5_2wQ}Z:@D%GWV.." editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="function calculateCurrentRPM(lasteventtime: number, currenteventtime: number) {" line1="    // work out the time between the last two low light levels events" line2="    // and assuming spinner has 3 arms so three low levels events per revolution" line3="    return (oneminuteinmilliseconds / ((currenteventtime - lasteventtime) * 3));" line4="}" numlines="5"></mutation></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>